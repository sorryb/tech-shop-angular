### Generate Category Summary Card
This component displays product categories cards. When selecting one, it will filter out all other categories except the selected one.
```
nx generate @nrwl/angular:library food-shop/category/category-summary-card
```
1. In `src/lib/components/category-summary` add the component 
 
 category-summary-card.component.ts
```ts 
import { Component, EventEmitter, Input, Output } from '@angular/core';  
import { CategorySummary } from '@food-shop-architecture-workshop/core/model';  
  
@Component({  
  selector: 'app-category-summary-card',  
  templateUrl: 'category-summary-card.component.html',  
  styleUrls: ['category-summary-card.component.scss'],  
})  
export class CategorySummaryCardComponent {  
  selected = 0;  
  
  @Input()  
  categorySummaries: CategorySummary[] = [];  
  
  @Output()  
  categorySelected: EventEmitter<CategorySummary | undefined> =  
    new EventEmitter<CategorySummary | undefined>();  
  
  updateCategorySelected(  
    categorySummary: CategorySummary | undefined,  
    selectedIndex: number  
  ) {  
    this.selected = selectedIndex;  
    this.categorySelected.emit(categorySummary);  
  }  
}

```

category-summary-card.component 2.html
```html
<div class='flex overflow-x-scroll mt-2 mb-2 w-full gap-4'>  
  <div (click)='updateCategorySelected(undefined, 0)'  
       [ngClass]="selected === 0 ? 'bg-orange-500 text-white': 'bg-white'"  
       class='rounded-full grow-0 shrink-0 shadow mb-2 p-2 flex items-center cursor-pointer'>  
    <img class='border-2 flex-none w-10 h-10 object-center object-cover bg-gray-100 rounded-full cursor-pointer'  
         src='assets/food/category/all.jpg'>  
    <div class='ml-2 mr-2 font-medium text-base text-md'>All items</div>  
  </div>  <div (click)='updateCategorySelected(item, i + 1)'  
       *ngFor='let item of categorySummaries; let i = index'  
       [ngClass]="selected === i + 1? 'bg-orange-500 text-white': 'bg-white'"  
       class='transition-all rounded-full mb-2 grow-0 shrink-0 shadow p-2 flex  items-center cursor-pointer'>  
    <img      [src]='item.image'  
      class='border-2 flex-none w-10 h-10 object-center object-cover bg-gray-100 rounded-full cursor-pointer'>  
    <div class='ml-2 mr-2 font-medium text-base text-md'>{{item.name}}</div>  
  </div></div>
```

category-summary-card.component.scss
```scss
:host {  
  @apply w-full;  
  @apply overflow-hidden;  
}
```

Update `food-shop-category-category-summary.module.ts` 
```ts 
import { NgModule } from '@angular/core';  
import { CommonModule } from '@angular/common';  
import { CategorySummaryCardComponent } from './components/category-summary/category-summary-card.component';  
  
@NgModule({  
  declarations: [CategorySummaryCardComponent],  
  imports: [CommonModule],  
  exports: [CategorySummaryCardComponent],  
})  
export class FoodShopCategoryCategorySummaryModule {}
```

Update `index.ts` to export the newly created module / component.
```ts 
export * from './lib/food-shop-category-category-summary.module';  
export * from './lib/components/category-summary/category-summary-card.component';
```

### Generate Favorite Widget Component Library 

```
nx generate @nrwl/angular:library food-shop/favorite/favorite-widget
```

In `src/lib/components` create two new components, `favorite-list` and `favorite-widget` 
1. Add favorite-list component 

favorite-list.component.ts
```ts
import { Component, EventEmitter, Input, Output } from '@angular/core';  
import {  
  Product,  
  ProductOrder,  
} from '@food-shop-architecture-workshop/core/model';  
  
@Component({  
  selector: 'app-favorite-list',  
  templateUrl: 'favorite-list.component.html',  
})  
export class FavoriteListComponent {  
  @Input()  
  products: Array<Product> = [];  
  
  @Output()  
  navigateToProducts: EventEmitter<boolean> = new EventEmitter<boolean>();  
  
  @Output()  
  addProductToCart: EventEmitter<ProductOrder> = new EventEmitter<ProductOrder>();  
  
  @Output()  
  addAllProductsToCart: EventEmitter<boolean> = new EventEmitter<boolean>();  
  
  @Output()  
  removeProductFromFavorite: EventEmitter<Product> = new EventEmitter<Product>();  
  
  onAddProducts() {  
    this.navigateToProducts.emit(true);  
  }  
  
  addToCart(product: Product) {  
    this.addProductToCart.emit({ product: product, quantity: 1 });  
  }  
  
  removeProduct(product: Product) {  
    this.removeProductFromFavorite.emit(product);  
  }  
}
```

favorite-list.component.html
```html
<ng-container *ngIf='products.length > 0 else missingProducts'>  
  <div class='bg-white bg-gray-800 w-full h-full rounded-lg p-1.5'  
       style='display: grid;grid-template-rows: 50px 1fr 60px;'>  
    <div class='text-lg font-bold text-white px-2.5 py-2'>Favorite products</div>  
    <div class='w-full px-2.5 overflow-y-scroll'>  
      <ul class='divide-y divide-gray-700' role='list'>  
        <li *ngFor='let item of products' class='py-2.5 flex items-center'>  
          <img [src]='item.img' class='flex-none w-20 h-20 rounded-lg '>  
          <div class='ml-4 flex-auto'>  
            <h3 class='font-medium text-white'>  
              <a>{{item.name}}</a>  
            </h3>            <p class='text-gray-300 text-sm'>Price : {{item.price}}</p>  
  
            <div class='mt-1'>  
              <a (click)='addToCart(item)'  
                 class='cursor-pointer text-orange-500 text-sm tracking-wide font-medium'>Add to cart</a>  
            </div>  
  
          </div>  
          <button (click)='removeProduct(item)' class='text-white' mat-icon-button matTooltip='Remove item'>  
            <mat-icon svgIcon='trash-light'></mat-icon>  
          </button>  
        </li>      </ul>    </div>    <div class='p-2.5'>  
      <button (click)='addAllProductsToCart.emit(true)' class='w-full text-white font-bold bg-gray-800' mat-button>Add  
        all to cart  
      </button>  
    </div>  </div></ng-container>  
<ng-template #missingProducts>  
  <div    class='bg-white bg-gray-800 text-white w-full h-full rounded-lg p-1.5 items-center flex flex-col justify-center h-[160px]'>  
    <div class='font-medium text-lg mb-2 pt-4'>Missing products</div>  
    <div class='text-base text-sm text-center text-gray-300 pl-5 pr-5'>Please add new products to favorite</div>  
    <div class='p-2.5 w-full'>  
      <button (click)='onAddProducts()' class='w-full text-white font-bold bg-gray-800' mat-button>Add products</button>  
    </div>  </div></ng-template>
    
```

2. Add favorite-widget component 

favorite-widget.component.ts
```ts
import {  
  Component,  
  EventEmitter,  
  Input,  
  OnDestroy,  
  Output,  
  TemplateRef,  
  ViewChild,  
  ViewContainerRef,  
} from '@angular/core';  
import { Subject, take, takeUntil } from 'rxjs';  
import { MatButton } from '@angular/material/button';  
import { Overlay, OverlayRef } from '@angular/cdk/overlay';  
import { Router } from '@angular/router';  
import { TemplatePortal } from '@angular/cdk/portal';  
import {  
  Product,  
  ProductOrder,  
} from '@food-shop-architecture-workshop/core/model';  
  
@Component({  
  selector: 'app-favorite-widget',  
  templateUrl: 'favorite-widget.component.html',  
})  
export class FavoriteWidgetComponent implements OnDestroy {  
  @Input()  
  favoriteProducts: Array<Product> = [];  
  @ViewChild('favoriteButton')  
  favoriteButton!: MatButton;  
  overlayRef: OverlayRef | undefined;  
  @ViewChild('favoriteList') templatePortalContent!: TemplateRef<any>;  
  @Output()  
  addProductToCart: EventEmitter<ProductOrder> = new EventEmitter<ProductOrder>();  
  @Output()  
  addAllProductsToCart: EventEmitter<boolean> = new EventEmitter<boolean>();  
  @Output()  
  removeProductFromFavorite: EventEmitter<Product> = new EventEmitter<Product>();  
  private disposeObservables: Subject<any> = new Subject();  
  
  constructor(  
    private overlay: Overlay,  
    private viewContainerRef: ViewContainerRef,  
    private router: Router  
  ) {}  
  
  showFavoriteDetails(): void {  
    this.overlayRef = this.overlay.create({  
      positionStrategy: this.overlay  
        .position()  
        .flexibleConnectedTo(this.favoriteButton._elementRef)  
        .withPositions([  
          {  
            originX: 'end',  
            originY: 'top',  
            overlayX: 'end',  
            overlayY: 'top',  
            offsetY: 40,  
          },  
        ]),  
      scrollStrategy: this.overlay.scrollStrategies.reposition(),  
      width: '350px',  
      maxHeight: '500px',  
      hasBackdrop: true,  
      disposeOnNavigation: true,  
    });  
    this.overlayRef.attach(  
      new TemplatePortal(this.templatePortalContent, this.viewContainerRef)  
    );  
    this.overlayRef  
      .backdropClick()  
      .pipe(takeUntil(this.disposeObservables), take(1))  
      .subscribe((_) => {  
        this.overlayRef?.detach();  
        this.overlayRef = undefined;  
      });  
  }  
  
  ngOnDestroy(): void {  
    this.disposeObservables.next('');  
  }  
  
  handleAddProducts() {  
    this.router.navigate([]);  
    this.overlayRef?.dispose();  
  }  
  
  handleAddProductToCart(productOrder: ProductOrder) {  
    this.addProductToCart.emit(productOrder);  
    if (this.favoriteProducts.length === 1) {  
      this.overlayRef?.dispose();  
    }  
  }  
  
  handleAddAllProductsToCart(event: boolean) {  
    this.addAllProductsToCart.emit(event);  
    this.overlayRef?.dispose();  
  }  
  
  handleRemoveProductFromFavorite(product: Product) {  
    this.removeProductFromFavorite.emit(product);  
    if (this.favoriteProducts.length === 1) {  
      this.overlayRef?.dispose();  
    }  
  }  
}
```

favorite-widget.component.html
```html
<button  
  #favoriteButton  
  (click)='showFavoriteDetails()' [matBadgeHidden]='favoriteProducts.length === 0'  
  [matBadge]='favoriteProducts.length'  
  mat-icon-button matBadgeOverlap>  
  <mat-icon class='text-gray-800' svgIcon='heart-solid'></mat-icon>  
</button>  
  
<ng-template #favoriteList>  
  <app-favorite-list    (addAllProductsToCart)='handleAddAllProductsToCart($event)'  
    (addProductToCart)='handleAddProductToCart($event)'  
    (navigateToProducts)='handleAddProducts()'  
    (removeProductFromFavorite)='handleRemoveProductFromFavorite($event)'  
    [products]='favoriteProducts' class='w-full'>  
  </app-favorite-list></ng-template>
```

food-shop-favorite-favorite-widget.module.ts
```ts 
import { NgModule } from '@angular/core';  
import { CommonModule } from '@angular/common';  
import { FavoriteWidgetComponent } from './components/favorite-widget/favorite-widget.component';  
import { FavoriteListComponent } from './components/favorite-list/favorite-list.component';  
import { MatButtonModule } from '@angular/material/button';  
import { MatIconModule } from '@angular/material/icon';  
import { MatBadgeModule } from '@angular/material/badge';  
import { MatTooltipModule } from '@angular/material/tooltip';  
  
@NgModule({  
  declarations: [FavoriteWidgetComponent, FavoriteListComponent],  
  imports: [  
    CommonModule,  
    MatButtonModule,  
    MatIconModule,  
    MatBadgeModule,  
    MatTooltipModule,  
  ],  
  exports: [FavoriteWidgetComponent],  
})  
export class FoodShopFavoriteFavoriteWidgetModule {}
```

index.ts
```ts
export * from './lib/food-shop-favorite-favorite-widget.module';  
export * from './lib/components/favorite-list/favorite-list.component';  
export * from './lib/components/favorite-widget/favorite-widget.component';
```

### Generate Cart Widget Component Library 
```
nx generate @nrwl/angular:library food-shop/cart/cart-widget
```

In `src/lib/components` create two new components, `cart-list` and `cart-widget` 
1. cart-list component 

cart-list.component.ts
```ts 
import { Component, EventEmitter, Input, Output } from '@angular/core';  
import {  
  Product,  
  ProductOrder,  
} from '@food-shop-architecture-workshop/core/model';  
  
@Component({  
  selector: 'app-cart-list',  
  templateUrl: 'cart-list.component.html',  
})  
export class CartListComponent {  
  @Input()  
  products: Array<ProductOrder> = [];  
  
  @Output()  
  navigateToProducts: EventEmitter<any> = new EventEmitter<any>();  
  
  @Output()  
  navigateToCheckout: EventEmitter<any> = new EventEmitter<any>();  
  
  @Output()  
  removeProductFromCart: EventEmitter<ProductOrder> = new EventEmitter<ProductOrder>();  
  
  @Output()  
  updateProductQuantity: EventEmitter<{ product: Product; quantity: number }> =  
    new EventEmitter<{ product: Product; quantity: number }>();  
  
  onAddProducts() {  
    this.navigateToProducts.emit(true);  
  }  
  
  removeProduct(productOrder: ProductOrder): void {  
    this.removeProductFromCart.emit(productOrder);  
  }  
  
  updateQuantity(product: Product, quantity: number) {  
    if (quantity > 0) {  
      this.updateProductQuantity.emit({ product, quantity });  
    }  
  }  
  
  onNavigateToCheckout() {  
    this.navigateToCheckout.emit(true);  
  }  
}
```

cart-list.component.html
```html
<ng-container *ngIf='products.length > 0 else missingProducts'>  
  <div class='bg-white bg-gray-800 w-full h-full rounded-lg p-1.5'  
       style='display: grid;grid-template-rows: 50px 1fr 60px;'>  
    <div class='text-lg font-bold text-white px-2.5 py-2'>Shopping cart</div>  
    <div class='w-full px-2.5 overflow-y-scroll'>  
      <ul class='divide-y divide-gray-700' role='list'>  
        <li *ngFor='let item of products' class='py-2.5 flex items-center'>  
          <img [src]='item.product.img' class='flex-none w-20 h-20 rounded-lg '>  
          <div class='ml-4 flex-auto'>  
            <h3 class='font-medium text-white'>  
              <a>{{item.product.name}}</a>  
            </h3>            <div class='text-gray-300 text-sm flex flex-row'>Quantity :  
              <div class='h-5 ml-2'>  
                <div class='flex flex-row h-10 w-full rounded-lg relative bg-transparent'>  
                  <button (click)='updateQuantity(item.product, item.quantity - 1)'  
                          class='bg-gray-800 text-gray-300 !min-w-[20px] !h-[20px] !w-[20px] !rounded-tr-none !rounded-br-none !p-0 !leading-[10px]'  
                          mat-button>  
                    <span class='leading-[10px]'>-</span>  
                  </button>                  <div                    class='bg-gray-900 text-gray-300 min-w-[20px] flex items-center justify-center text-xs font-medium !h-[20px]'>{{item.quantity}}</div>  
                  <button (click)='updateQuantity(item.product, item.quantity + 1)'  
                          class='bg-gray-800 text-gray-300 !min-w-[20px] !h-[20px] w-[20px] !rounded-tl-none !rounded-bl-none !p-0 !leading-[10px]'  
                          mat-button>  
                    +  
                  </button>  
                </div>              </div>            </div>  
            <p class='text-gray-300 text-sm'>Price : {{item.product.price}}</p>  
          </div>          <button (click)='removeProduct(item)' class='text-white' mat-icon-button matTooltip='Remove item'>  
            <mat-icon svgIcon='trash-light'></mat-icon>  
          </button>        </li>      </ul>    </div>    <div class='p-2.5'>  
      <button (click)='onNavigateToCheckout()' class='w-full text-white font-bold bg-gray-800' mat-button>Checkout  
      </button>  
    </div>  </div></ng-container>  
<ng-template #missingProducts>  
  <div    class='bg-white bg-gray-800 text-white w-full h-full rounded-lg p-1.5 items-center flex flex-col justify-center h-[160px]'>  
    <div class='font-medium text-lg mb-2 pt-4'>Empty cart</div>  
    <div class='text-base text-sm text-center text-gray-300 pl-5 pr-5'>Please add new products to cart in order to  
      proceed with the order  
    </div>  
    <div class='p-2.5 w-full'>  
      <button (click)='onAddProducts()' class='w-full text-white font-bold bg-gray-800' mat-button>Add products</button>  
    </div>  </div></ng-template>
```

2. cart-widget
cart-widget.component.ts
```ts
import {  
  Component,  
  EventEmitter,  
  Input,  
  OnDestroy,  
  Output,  
  TemplateRef,  
  ViewChild,  
  ViewContainerRef,  
} from '@angular/core';  
import { Overlay, OverlayRef } from '@angular/cdk/overlay';  
import { MatButton } from '@angular/material/button';  
import { TemplatePortal } from '@angular/cdk/portal';  
import { Subject, take, takeUntil } from 'rxjs';  
import { Router } from '@angular/router';  
import {  
  Product,  
  ProductOrder,  
} from '@food-shop-architecture-workshop/core/model';  
  
@Component({  
  selector: 'app-cart-widget',  
  templateUrl: 'cart-widget.component.html',  
})  
export class CartWidgetComponent implements OnDestroy {  
  @Input()  
  cartProducts: Array<ProductOrder> = [];  
  @Input()  
  cartQuantity: number = 0;  
  @Output()  
  removeProductFromCart: EventEmitter<ProductOrder> = new EventEmitter<ProductOrder>();  
  @Output()  
  updateProductQuantity: EventEmitter<{ product: Product; quantity: number }> =  
    new EventEmitter<{ product: Product; quantity: number }>();  
  @ViewChild('cartButton')  
  cartButton!: MatButton;  
  overlayRef: OverlayRef | undefined;  
  @ViewChild('cartList') templatePortalContent!: TemplateRef<any>;  
  private disposeObservables: Subject<any> = new Subject();  
  
  constructor(  
    private overlay: Overlay,  
    private viewContainerRef: ViewContainerRef,  
    private router: Router  
  ) {}  
  
  showCartDetails(): void {  
    this.overlayRef = this.overlay.create({  
      positionStrategy: this.overlay  
        .position()  
        .flexibleConnectedTo(this.cartButton._elementRef)  
        .withPositions([  
          {  
            originX: 'end',  
            originY: 'top',  
            overlayX: 'end',  
            overlayY: 'top',  
            offsetY: 40,  
          },  
        ]),  
      scrollStrategy: this.overlay.scrollStrategies.reposition(),  
      width: '350px',  
      maxHeight: '500px',  
      hasBackdrop: true,  
      disposeOnNavigation: true,  
    });  
    this.overlayRef.attach(  
      new TemplatePortal(this.templatePortalContent, this.viewContainerRef)  
    );  
    this.overlayRef  
      .backdropClick()  
      .pipe(takeUntil(this.disposeObservables), take(1))  
      .subscribe((_) => {  
        this.overlayRef?.detach();  
        this.overlayRef = undefined;  
      });  
  }  
  
  ngOnDestroy(): void {  
    this.disposeObservables.next('');  
  }  
  
  navigateToProductsPage() {  
    this.router.navigate([]);  
    this.overlayRef?.dispose();  
  }  
  
  handleRemoveProduct(productOrder: ProductOrder) {  
    this.removeProductFromCart.emit(productOrder);  
  }  
  
  handleUpdateQuantity(payload: { product: Product; quantity: number }) {  
    this.updateProductQuantity.emit(payload);  
  }  
  
  navigateToCheckoutPage() {  
    this.overlayRef?.dispose();  
    this.router.navigate(['checkout']);  
  }  
}
```

cart-widget.component.html
``` html
<button  
  #cartButton  
  (click)='showCartDetails()'  
  [matBadgeHidden]='cartQuantity === 0'  
  [matBadge]='cartQuantity' mat-icon-button matBadgeOverlap>  
  <mat-icon class='text-gray-800' svgIcon='basket'></mat-icon>  
</button>  
  
<ng-template #cartList>  
  <app-cart-list    (navigateToCheckout)='navigateToCheckoutPage()'  
    (navigateToProducts)='navigateToProductsPage()'  
    (removeProductFromCart)='handleRemoveProduct($event)'  
    (updateProductQuantity)='handleUpdateQuantity($event)'  
    [products]='cartProducts'  
    class='w-full'>  
  </app-cart-list>  
</ng-template>

```

food-shop-cart-cart-widget.module.ts
```ts
import { NgModule } from '@angular/core';  
import { CommonModule } from '@angular/common';  
import { CartListComponent } from './components/cart-list/cart-list.component';  
import { CartWidgetComponent } from './components/cart-widget/cart-widget.component';  
import { MatButtonModule } from '@angular/material/button';  
import { MatIconModule } from '@angular/material/icon';  
import { MatBadgeModule } from '@angular/material/badge';  
import { MatTooltipModule } from '@angular/material/tooltip';  
  
@NgModule({  
  declarations: [CartListComponent, CartWidgetComponent],  
  imports: [  
    CommonModule,  
    MatButtonModule,  
    MatIconModule,  
    MatBadgeModule,  
    MatTooltipModule,  
  ],  
  exports: [CartWidgetComponent],  
})  
export class FoodShopCartCartWidgetModule {}
```

index.ts
```ts
export * from './lib/food-shop-cart-cart-widget.module';  
export * from './lib/components/cart-list/cart-list.component';  
export * from './lib/components/cart-widget/cart-widget.component';
```

### Generate Orders Widget Component Library
```
nx generate @nrwl/angular:library food-shop/orders/orders-widget
```

In `src/lib/components` create orders-widget component
1. orders-widget
orders-widget.component.ts
```ts 
import { Component, EventEmitter, Input, Output } from '@angular/core';  
import { Order } from '@food-shop-architecture-workshop/core/model';  
  
@Component({  
  selector: 'app-orders-widget',  
  templateUrl: 'orders-widget.component.html',  
})  
export class OrdersWidgetComponent {  
  @Input()  
  orders: Order[] = [];  
  
  @Output()  
  ordersClicked: EventEmitter<boolean> = new EventEmitter<boolean>();  
}
```

orders-widget.component.html
```html
<button  
  (click)='ordersClicked.emit(true)'  
  [matBadgeHidden]='orders.length === 0'  
  [matBadge]='orders.length' mat-icon-button  
  matBadgeOverlap  matTooltip='Show your orders'>  
  <mat-icon class='text-gray-800' svgIcon='memo-circle-info-solid'></mat-icon>  
</button>

```

food-shop-orders-orders-widget.module.ts
```ts
import { NgModule } from '@angular/core';  
import { CommonModule } from '@angular/common';  
import { OrdersWidgetComponent } from './components/orders-widget/orders-widget.component';  
import { MatButtonModule } from '@angular/material/button';  
import { MatIconModule } from '@angular/material/icon';  
import { MatBadgeModule } from '@angular/material/badge';  
import { MatTooltipModule } from '@angular/material/tooltip';  
  
@NgModule({  
  declarations: [OrdersWidgetComponent],  
  imports: [  
    CommonModule,  
    MatButtonModule,  
    MatIconModule,  
    MatBadgeModule,  
    MatTooltipModule,  
  ],  
  exports: [OrdersWidgetComponent],  
})  
export class FoodShopOrdersOrdersWidgetModule {}
```

index.ts
```ts
export * from './lib/food-shop-orders-orders-widget.module';
```

### Generate Cart Util Library 
This library will be used to calculate cart total, subtotal, payment fee, service charge, vatRate. It is useful since we will build multiple applications using different state management solutions, but it will share the same libraries.

In `src/lib` create a `cart.util.ts`
cart.util.ts
```ts 
import { inject } from '@angular/core';  
import { FormBuilder, Validators } from '@angular/forms';  
import {  
  OrderPaymentSummary,  
  OrderPaymentSummaryExtraFee,  
  ProductOrder,  
} from '@food-shop-architecture-workshop/core/model';  
  
export const mapPaymentFeeFromCardData = (  
  cardData: Array<{ selected: boolean; value: number }>  
): number => {  
  const selected = cardData.find((c) => c.selected);  
  return selected ? selected.value : 0;  
};  
  
export const calculateCartSubtotal = (productOrder: ProductOrder[]): number => {  
  return productOrder.length > 0  
    ? roundTo2Decimals(  
        productOrder  
          .map((prod) => prod.quantity * prod.product.price)  
          .reduce((a, b) => a + b)  
      )  
    : 0;  
};  
  
export const calculateServiceCharge = (  
  subTotal: number,  
  serviceChargeValue: number  
): number => {  
  return roundTo2Decimals((subTotal * serviceChargeValue) / 100);  
};  
  
export const calculateVatRate = (  
  subtotalIncludingTaxes: number,  
  vatRate: number  
): number => {  
  return roundTo2Decimals((subtotalIncludingTaxes * vatRate) / 100);  
};  
  
export const calculateTotal = (  
  subTotal: number,  
  serviceChargeValue: number,  
  paymentMethodValue: number,  
  vatRage: number  
) => {  
  return roundTo2Decimals(  
    subTotal + serviceChargeValue + paymentMethodValue + vatRage  
  );  
};  
  
export const roundTo2Decimals = (value: number): number => {  
  return Math.round((value + Number.EPSILON) * 100) / 100;  
};  
  
export const getCartPriceModel = (  
  productOrders: ProductOrder[],  
  vatRatePercentage: number,  
  serviceChargePercentage: number  
): OrderPaymentSummary => {  
  const subtotal = calculateCartSubtotal(productOrders);  
  const serviceCharge = calculateServiceCharge(  
    subtotal,  
    serviceChargePercentage  
  );  
  const vatRate = calculateVatRate(subtotal + serviceCharge, vatRatePercentage);  
  return {  
    subtotal,  
    serviceChargePercentage,  
    vatRatePercentage,  
    vatRate,  
    serviceCharge,  
    total: roundTo2Decimals(subtotal + serviceCharge + vatRate),  
  };  
};  
  
export const getCartPriceFeeModel = (  
  cartCheckoutModel: OrderPaymentSummary,  
  paymentFee: number  
): OrderPaymentSummaryExtraFee => {  
  return {  
    ...cartCheckoutModel,  
    paymentFee,  
    total: cartCheckoutModel.total + paymentFee,  
  };  
};  
  
export const buildCheckoutForm = () => {  
  const formBuilder: FormBuilder = inject(FormBuilder);  
  return formBuilder.group({  
    name: ['', Validators.required],  
    table: ['', Validators.required],  
    comment: [''],  
  });  
};
```

index.ts
```ts
export * from './lib/cart.utility';
```

### Generate Input Number Button Library 
It is part of shared library so that it can be reused by both portals.
```
nx generate @nrwl/angular:library shared/components/input-number-button
```

In `src/lib/components/input-number-button` create the component.

input-number-button.component.ts
```ts
import { Component, EventEmitter, Input, Output } from '@angular/core';  
  
@Component({  
  selector: 'app-input-number-button',  
  templateUrl: 'input-number-button.component.html',  
})  
export class InputNumberButtonComponent {  
  @Input()  
  value = 0;  
  
  @Input()  
  minValue = 0;  
  
  @Output()  
  valueChanged: EventEmitter<number> = new EventEmitter<number>();  
  
  updateValue(value: number) {  
    if (value >= this.minValue) {  
      this.value = value;  
      this.valueChanged.emit(this.value);  
    }  
  }  
}
```

input-number-button.component.html
```html
<div class='h-10'>  
  <div class='flex flex-row h-10 w-full rounded-lg relative bg-transparent'>  
    <button (click)='updateValue(value - 1)' class='bg-gray-200 !min-w-[20px] !rounded-tr-none !rounded-br-none '  
            mat-button>  
      <mat-icon class='!h-[20px]' svgIcon='minus-solid'></mat-icon>  
    </button>    <div class='bg-gray-200 min-w-[50px] flex items-center justify-center text-lg font-medium'>{{value}}</div>  
    <button (click)='updateValue(value + 1)' class='bg-gray-200 !min-w-[20px] !rounded-tl-none !rounded-bl-none '  
            mat-button>  
      <mat-icon class='!h-[20px]' svgIcon='plus-solid'></mat-icon>  
    </button>  </div></div>
```

shared-components-input-number-button.module.ts
```ts
import { NgModule } from '@angular/core';  
import { CommonModule } from '@angular/common';  
import { InputNumberButtonComponent } from './components/input-number-button/input-number-button.component';  
import { MatButtonModule } from '@angular/material/button';  
import { MatIconModule } from '@angular/material/icon';  
  
@NgModule({  
  declarations: [InputNumberButtonComponent],  
  imports: [CommonModule, MatButtonModule, MatIconModule],  
  exports: [InputNumberButtonComponent],  
})  
export class SharedComponentsInputNumberButtonModule {}

```

index.ts
```ts 
export * from './lib/shared-components-input-number-button.module';  
export * from './lib/components/input-number-button/input-number-button.component';
```

### Generate Product List Component Library 
Product List and Product Details are components which can be part of the same library, since the Product Details is being used from the context of Product List. But Product Details can also be used from the context of both cart & favorite widget without product list. 

```
nx generate @nrwl/angular:library food-shop/product/product-list
```

In `src/lib/components/product-list` add the component

product-list.component.ts
```ts
import { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';  
import { BreakpointObserver, Breakpoints } from '@angular/cdk/layout';  
import { combineLatest, map, Observable } from 'rxjs';  
import { Product } from '@food-shop-architecture-workshop/core/model';  
  
@Component({  
  selector: 'app-product-list',  
  templateUrl: 'product-list.component.html',  
})  
export class ProductListComponent implements OnInit {  
  @Input()  
  products: Product[] = [];  
  ingredientsSliceValue$: Observable<number>;  
  
  @Output()  
  onShowProductDetails: EventEmitter<Product> = new EventEmitter<Product>();  
  
  @Output()  
  onAddToBag: EventEmitter<Product> = new EventEmitter<Product>();  
  
  constructor(private breakpointsObserver: BreakpointObserver) {  
    this.ingredientsSliceValue$ = combineLatest([  
      breakpointsObserver.observe(Breakpoints.XSmall),  
      breakpointsObserver.observe(Breakpoints.Small),  
      breakpointsObserver.observe(Breakpoints.Medium),  
      breakpointsObserver.observe(Breakpoints.Large),  
      breakpointsObserver.observe(Breakpoints.XLarge),  
    ]).pipe(  
      map(([xs, sm, md, lg, xl]) =>  
        xs.matches  
          ? 400  
          : sm.matches  
          ? 35  
          : md.matches  
          ? 25  
          : lg.matches  
          ? 25  
          : 30  
      )  
    );  
  }  
  
  ngOnInit(): void {}  
  
  addToBag(product: Product) {  
    this.onAddToBag.emit(product);  
  }  
  
  showProductDetails(product: Product) {  
    this.onShowProductDetails.emit(product);  
  }  
}
```

product-list.component.html
```html
<div class='w-full mx-auto p-2'>  
  <div class='grid grid-cols-1 gap-y-12 sm:grid-cols-2 sm:gap-x-6 lg:grid-cols-4 xl:gap-x-8'>  
    <div *ngFor='let item of products'>  
      <div class='relative'>  
        <div class='relative w-full h-72 rounded-lg overflow-hidden hover:scale-105 transform-gpu transition-all'>  
          <img [src]='item.img' class='w-full h-full object-center object-cover cursor-pointer '>  
          <div            (click)='showProductDetails(item)'  
            class='absolute bottom-0 inset-x-0 h-72 rounded-lg p-4 flex items-end justify-end overflow-hidden cursor-pointer' mat-ripple>  
            <div aria-hidden='true'  
                 class='absolute inset-x-0 bottom-0 h-36 bg-gradient-to-t from-black opacity-50'></div>  
            <p class='relative text-lg font-semibold text-white'>${{item.price}}</p>  
          </div>        </div>        <div class='relative mt-4'>  
          <h3 class='text-sm font-medium text-gray-900'>{{item.name}}</h3>  
          <p class='mt-1 text-sm text-gray-500'>  
            <ng-container *ngIf='ingredientsSliceValue$ | async as sliceValue'>  
              <ng-container *ngIf='item.ingredients'>  
                {{item.ingredients.join(', ') | slice : 0 : sliceValue}}  
                <ng-container *ngIf="item.ingredients.join(', ').length >=sliceValue">...</ng-container>  
              </ng-container>            </ng-container>          </p>        </div>      </div>  
      <div class='mt-6'>  
        <button (click)='addToBag(item)' class='w-full bg-gray-100' mat-button>  
          <span class='font-medium'> Add to cart</span>  
        </button>      </div>    </div>  </div></div>
```

food-shop-product-product-list.module.ts
```ts
import { NgModule } from '@angular/core';  
import { CommonModule } from '@angular/common';  
import { ProductListComponent } from './components/product-list/product-list.component';  
import { MatButtonModule } from '@angular/material/button';  
import { MatRippleModule } from '@angular/material/core';  
  
@NgModule({  
  declarations: [ProductListComponent],  
  imports: [CommonModule, MatButtonModule, MatRippleModule],  
  exports: [ProductListComponent],  
})  
export class FoodShopProductProductListModule {}
```

index.ts
```ts
export * from './lib/food-shop-product-product-list.module';  
export * from './lib/components/product-list/product-list.component';
```

### Generate Product Details Library

```
nx generate @nrwl/angular:library food-shop/product/product-details
```

In `src/lib/components/product-details` add the component

product-details.component.ts
```ts
import { Component, EventEmitter, Input, Output } from '@angular/core';  
import { Product } from '@food-shop-architecture-workshop/core/model';  
  
@Component({  
  selector: 'app-product-details',  
  templateUrl: 'product-details.component.html',  
})  
export class ProductDetailsComponent {  
  @Input()  
  product!: Product;  
  
  @Input()  
  favorite: boolean | null = false;  
  
  @Input()  
  quantity!: number;  
  
  @Output()  
  addToBagEvent: EventEmitter<{ product: Product; quantity: number }> =  
    new EventEmitter<any>();  
  
  @Output()  
  closeEvent: EventEmitter<any> = new EventEmitter<any>();  
  
  @Output()  
  favoriteChanged: EventEmitter<{ product: Product; favorite: boolean }> =  
    new EventEmitter<{ product: Product; favorite: boolean }>();  
  
  handleQuantityChanged(quantity: number) {  
    this.quantity = quantity;  
  }  
  
  addToBag() {  
    this.addToBagEvent.emit({ product: this.product, quantity: this.quantity });  
  }  
  
  close() {  
    this.closeEvent.emit();  
  }  
  
  favoriteClicked() {  
    this.favorite = !this.favorite;  
    this.favoriteChanged.emit({  
      product: this.product,  
      favorite: this.favorite,  
    });  
  }  
}
```

product-details.component.html

```html
<mat-dialog-content>  
  <div class='bg-white max-w-[584px] pb-5'>  
  
    <div class='flex items-center w-full justify-center relative'>  
      <div class='flex-none w-full '>  
        <img [src]='product.img' class='w-full h-[368px] object-center object-cover'>  
        <button (click)='close()' class='!absolute right-[16px] top-[16px] !text-white' mat-icon-button>  
          <mat-icon svgIcon='close'></mat-icon>  
        </button>        <button (click)='favoriteClicked()'  
                [ngClass]="favorite ? '!text-red-500':'!text-gray-800'"  
                class='!absolute right-[16px] bottom-[16px] !bg-white ' mat-icon-button>  
          <mat-icon [svgIcon]="favorite ? 'heart-solid':'heart-light'"></mat-icon>  
        </button>      </div>  
    </div>  
    <div class='mt-4 text-center '>  
      <h1 class='text-3xl font-extrabold tracking-tight text-gray-900 sm:text-4xl'>{{product.name}}</h1>  
    </div>  
    <div class='flex items-center pl-2 pr-2'>  
      <p class='ml-2 text-base font-medium text-gray-600 text-center w-full mt-5'>  
        <ng-container *ngIf='product.ingredients'>  
          {{product.ingredients.join(', ')}}  
        </ng-container>  
      </p>    </div>  
    <div class='mt-4 space-y-6 pl-5 pr-5'>  
      <p class=' text-gray-500'>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Adipisci alias blanditiis  
        consequatur delectus dolor mollitia recusandae reiciendis ullam voluptate! Aperiam deleniti enim iure  
        laboriosam pariatur. Aliquid deleniti  
        dolor eius eligendi, error esse, fugit illo magni, non pariatur sequi sit voluptates.</p>  
    </div>  
    <div class='flex flex-row items-center pl-5 pr-5 mt-5 gap-5'>  
  
      <app-input-number-button        (valueChanged)='handleQuantityChanged($event)'  
        [minValue]='1'  
        [value]='quantity'></app-input-number-button>  
  
      <button        (click)='addToBag()'  
        class='bg-gray-800 hover:bg-gray-900 text-white font-medium py-2 px-4 rounded w-full flex flex-row justify-between' matRipple>  
        <span>Add to cart</span>  
        <span>${{product.price}}</span>  
      </button>    </div>  
  </div></mat-dialog-content>
```

food-shop-product-product-details.module.ts
```ts
import { NgModule } from '@angular/core';  
import { CommonModule } from '@angular/common';  
import { ProductDetailsComponent } from './components/product-details/product-details.component';  
import { MatDialogModule } from '@angular/material/dialog';  
import { MatIconModule } from '@angular/material/icon';  
import { MatButtonModule } from '@angular/material/button';  
import { SharedComponentsInputNumberButtonModule } from '@food-shop-architecture-workshop/shared/components/input-number-button';  
import { MatRippleModule } from '@angular/material/core';  
  
@NgModule({  
  declarations: [ProductDetailsComponent],  
  imports: [  
    CommonModule,  
    SharedComponentsInputNumberButtonModule,  
    MatDialogModule,  
    MatIconModule,  
    MatButtonModule,  
    MatRippleModule  
  ],  
  exports: [ProductDetailsComponent],  
})  
export class FoodShopProductProductDetailsModule {}
```

### Generate Checkout Details Library

```
nx generate @nrwl/angular:library food-shop/checkout-details
```

In `src/lib/checkout-details` add component

checkout-details.component.ts

```ts
import { Component, EventEmitter, Input, Output } from '@angular/core';  
import { FormGroup } from '@angular/forms';  
import { InputRadioCardModel } from '@food-shop-architecture-workshop/shared/components/input-radio-card';  
import {  
  Order,  
  OrderPaymentSummaryExtraFee,  
  OrderStatus,  
  Product,  
  ProductOrder,  
} from '@food-shop-architecture-workshop/core/model';  
import { buildCheckoutForm } from '@food-shop-architecture-workshop/food-shop/cart/cart-utility';  
  
@Component({  
  selector: 'app-checkout-details',  
  templateUrl: 'checkout-details.component.html',  
})  
export class CheckoutDetailsComponent {  
  checkoutFormGroup: FormGroup;  
  @Input()  
  cartProducts: Array<ProductOrder> = [];  
  @Input()  
  orderPaymentSummaryExtraFee!: OrderPaymentSummaryExtraFee;  
  @Input()  
  paymentMethodCards: InputRadioCardModel[] = [];  
  @Input()  
  paymentMethodTitle: string = '';  
  @Output()  
  updateProductQuantity: EventEmitter<ProductOrder> = new EventEmitter<ProductOrder>();  
  @Output()  
  removeProduct: EventEmitter<ProductOrder> = new EventEmitter<ProductOrder>();  
  @Output()  
  createOrder: EventEmitter<Order> = new EventEmitter<Order>();  
  @Output()  
  paymentMethodChanged: EventEmitter<InputRadioCardModel[]> = new EventEmitter<  
    InputRadioCardModel[]  
  >();  
  
  constructor() {  
    this.checkoutFormGroup = buildCheckoutForm();  
  }  
  
  updateQuantity(product: Product, quantity: number) {  
    if (quantity > 0) {  
      this.updateProductQuantity.emit({ product, quantity });  
    }  
  }  
  
  submitOrder() {  
    if (this.checkoutFormGroup.invalid) {  
      this.checkoutFormGroup.markAllAsTouched();  
    } else {  
      const customerInfo = this.checkoutFormGroup.value;  
      this.createOrder.emit({  
        orderedProducts: this.cartProducts,  
        name: customerInfo.name,  
        comment: customerInfo.comment,  
        table: customerInfo.table,  
        orderPaymentSummaryExtraFee: this.orderPaymentSummaryExtraFee,  
        // workaround since we don't have a real backend  
        orderStatus: OrderStatus.ORDER_NEW,  
        orderDate: new Date(),  
      });  
    }  
  }  
  
  handlePaymentMethodChange(paymentMethodsCard: InputRadioCardModel[]) {  
    this.paymentMethodCards = paymentMethodsCard;  
    this.paymentMethodChanged.emit(paymentMethodsCard);  
  }  
}
```

checkout-details.component.html

```html
<div class='lg:grid lg:grid-cols-[minmax(0,_100%)_minmax(0,_100%)] lg:gap-x-8 lg:h-full '>  
  <div class='lg:overflow-y-scroll relative pt-[40px] mt-5 ml-4'>  
    <div class='absolute top-0 left-0 w-full h-[40px]'>  
      <h2 class='text-lg font-medium text-gray-900'>Contact information</h2>  
    </div>    <div [formGroup]='checkoutFormGroup' class='mt-4'>  
      <mat-form-field appearance='outline' class='w-full'>  
        <mat-label>Name</mat-label>  
        <input formControlName='name' matInput placeholder='Ex. Jhon Doe' type='text'>  
        <mat-error *ngIf="checkoutFormGroup.get('name')?.hasError('required') ">  
          Please enter your name  
        </mat-error>  
      </mat-form-field>      <mat-form-field appearance='outline' class='w-full'>  
        <mat-label>Table</mat-label>  
        <mat-select disableOptionCentering formControlName='table' panelClass='custom-select'>  
          <mat-option *ngFor='let topping of [1,2,3,4,5,6,7,8,9]' [value]='topping'>{{topping}}</mat-option>  
        </mat-select>        <mat-error *ngIf="checkoutFormGroup.get('table')?.hasError('required') ">  
          Please select a table  
        </mat-error>  
      </mat-form-field>      <mat-form-field appearance='outline' class='w-full mb-5'>  
        <mat-label>Leave a comment</mat-label>  
        <textarea formControlName='comment' matInput placeholder='Ex. It makes me feel...'></textarea>  
      </mat-form-field>    </div>    <app-input-radio-card      (inputRadioCardModelChanged)='handlePaymentMethodChange($event)'  
      [inputRadioCardModel]='paymentMethodCards'  
      [title]='paymentMethodTitle'>  
    </app-input-radio-card>  </div>  <div class='grid grid-rows-[minmax(0,_max-content)_minmax(220px,_220px)] overflow-y-hidden mt-5 ml-4 mr-4 '>  
    <div class='lg:overflow-y-scroll relative pt-[40px]'>  
      <div class='absolute top-0 left-0 w-full h-[40px]'>  
        <h2 class='text-lg font-medium text-gray-900'>Cart details</h2>  
      </div>      <ul class='pt-4 h-full lg:overflow-y-scroll'>  
        <ng-container *ngFor='let productCart of cartProducts'>  
          <li class='flex items-start pb-4 space-x-4 '>  
            <img [src]='productCart.product.img'  
                 alt='Product image' class='flex-none w-[120px] h-[120px] rounded-md object-center object-cover' />  
            <div class='flex-auto space-y-1 h-full mt-auto mb-auto'>  
              <h3 class='text-lg'>{{productCart.product.name}}</h3>  
              <div class='flex flex-row gap-2 text-gray-500 text-sm font-normal'>  
                <ng-container *ngIf='productCart.product.ingredients'>  
                  {{productCart.product.ingredients.join(', ')}}  
                </ng-container>  
              </div>              <div class='text-gray-800 text-sm flex flex-row'>  
                <div class=' mt-2'>  
                  <div class='flex flex-row  w-full rounded-lg relative bg-transparent'>  
                    <button (click)='updateQuantity(productCart.product, productCart.quantity - 1)'  
                            class='bg-gray-200 text-gray-800 !min-w-[20px] !h-[30px] !w-[30px] !rounded-tr-none !rounded-br-none !p-0 !leading-[10px]'  
                            mat-button>  
                      <span class='leading-[30px]'>-</span>  
                    </button>                    <div                      class='bg-gray-300 text-gray-800 min-w-[30px] flex items-center justify-center text-xs font-medium !h-[30px]'>{{productCart.quantity}}</div>  
                    <button (click)='updateQuantity(productCart.product, productCart.quantity + 1)'  
                            class='bg-gray-200 text-gray-800 !min-w-[30px] !h-[30px] !w-[30px] !rounded-tl-none !rounded-bl-none !p-0 !leading-[30px]'  
                            mat-button>  
                      +  
                    </button>  
                  </div>                </div>                <div class='mt-2 ml-2'>  
                  <button (click)='removeProduct.emit(productCart)' class='bg-gray-200 text-gray-800 !min-w-[20px] !h-[30px] !w-[30px] !p-0 !leading-[10px]'  
                          mat-button  
                          matTooltip='Remove product'>  
                    <mat-icon class='!h-[12px]' svgIcon='trash-light'></mat-icon>  
                  </button>                </div>  
  
              </div>            </div>            <div class='mt-auto mb-auto'>  
              <p class='text-end flex-none  text-gray-800 text-sm text-gray-500 font-normal'>  
                ${{productCart.product.price}}</p>  
              <p class='text-end flex-none  text-gray-800 text-sm text-gray-500 font-normal'>  
                x {{productCart.quantity}}</p>  
              <p class='text-end flex-none  text-gray-800 whitespace-nowrap font-semibold mt-2'>  
                ${{productCart.quantity * productCart.product.price | number : '1.2-2'}}</p>  
            </div>          </li>        </ng-container>      </ul>    </div>    <ng-container *ngIf='orderPaymentSummaryExtraFee'>  
      <div>        <dl class='border-t border-gray-200 py-2 space-y-1.5 '>  
          <div class='flex items-center justify-between text-gray-500'>  
            <dt class='text-sm'>Subtotal</dt>  
            <dd class='text-sm '>${{orderPaymentSummaryExtraFee.subtotal | number : '1.2-2'}}</dd>  
          </div>          <div class='flex items-center justify-between text-gray-500'>  
            <dt class='text-sm'>Service charge ({{orderPaymentSummaryExtraFee.serviceChargePercentage}}%)</dt>  
            <dd class='text-sm  '>${{orderPaymentSummaryExtraFee.serviceCharge | number : '1.2-2'}}</dd>  
          </div>          <div class='flex items-center justify-between text-gray-500'>  
            <dt class='text-sm'>Payment method</dt>  
            <dd class='text-sm  '>${{orderPaymentSummaryExtraFee.paymentFee}}</dd>  
          </div>          <div class='flex items-center justify-between text-gray-500'>  
            <dt class='text-sm'>Vat Rate ({{orderPaymentSummaryExtraFee.vatRatePercentage}}%)</dt>  
            <dd class='text-sm  '>${{orderPaymentSummaryExtraFee.vatRate | number : '1.2-2'}}</dd>  
          </div>  
          <div class='flex items-center justify-between border-t border-b border-gray-200 pt-2 pb-2'>  
            <dt class=' font-medium'>Total</dt>  
            <dd class=' font-medium text-gray-900'>${{orderPaymentSummaryExtraFee.total | number : '1.2-2'}}</dd>  
          </div>        </dl>        <div class='pt-2 '>  
          <button            (click)='submitOrder()'  
            class='bg-gray-800 hover:bg-gray-900 text-white font-medium py-2 px-4 rounded w-full flex flex-row justify-center'>  
            Confirm order  
          </button>  
        </div>      </div>    </ng-container>  </div></div>
```

food-shop-checkout-checkout-details.module.ts
```ts
import { NgModule } from '@angular/core';  
import { CommonModule } from '@angular/common';  
import { CheckoutDetailsComponent } from './checkout-details/checkout-details.component';  
import { MatFormFieldModule } from '@angular/material/form-field';  
import { MatSelectModule } from '@angular/material/select';  
import { MatInputModule } from '@angular/material/input';  
import { ReactiveFormsModule } from '@angular/forms';  
import { MatButtonModule } from '@angular/material/button';  
import { MatTooltipModule } from '@angular/material/tooltip';  
import { MatIconModule } from '@angular/material/icon';  
import { SharedComponentsInputRadioCardModule } from '@food-shop-architecture-workshop/shared/components/input-radio-card';  
  
@NgModule({  
  declarations: [CheckoutDetailsComponent],  
  imports: [  
    CommonModule,  
    MatButtonModule,  
    ReactiveFormsModule,  
    MatFormFieldModule,  
    MatInputModule,  
    MatSelectModule,  
    MatIconModule,  
    MatTooltipModule,  
    SharedComponentsInputRadioCardModule,  
  ],  
  exports: [CheckoutDetailsComponent],  
})  
export class FoodShopCheckoutCheckoutDetailsModule {}
```

index.ts
```ts
export * from './lib/food-shop-checkout-checkout-details.module';  
export * from './lib/checkout-details/checkout-details.component';
```

### Generate Order List (Order Card List) Library 
Generate Order List component which is used by food-shop app

```
nx generate @nrwl/angular:library food-shop/orders/order-card-list
```

In `src/lib/components/order-card-list` create the component.
order-card-list.component.ts
```ts
import { Component, EventEmitter, Input, Output } from '@angular/core';  
import {  
  Order,  
  OrderStatus,  
} from '@food-shop-architecture-workshop/core/model';  
  
@Component({  
  selector: 'app-order-card-list',  
  templateUrl: 'order-card-list.component.html',  
})  
export class OrderCardListComponent {  
  ORDER_STATUS = OrderStatus;  
  
  @Input()  
  orders: Array<Order> = [];  
  
  @Output()  
  orderClicked: EventEmitter<Order> = new EventEmitter<Order>();  
}
```

order-card-list.component.html
```html
<div class='mt-4 grid grid-cols-1 gap-y-6 sm:grid-cols-1 sm:gap-x-2 px-2'>  
  <ng-container *ngFor='let order  of orders'>  
  
    <div      class='relative transition-all hover:bg-gray-50 hover:shadow-xl bg-white border rounded-lg shadow-sm p-4 flex cursor-pointer focus:outline-none'  
      (click)='orderClicked.emit(order)'>  
      <div class='flex-1 flex w-full'>  
        <div class='flex flex-col w-full'>  
          <span class='block text-lg tracking-tight font-semibold  text-orange-500'>#{{order.id}}  <span  
            class='text-gray-800'> - Table {{order.table}}</span></span>  
          <div class='flex flex-row items-center'>  
            <div class='flex items-center text-md text-gray-500 font-normal mr-1'>Name:</div>  
            <div class='text-md font-medium '>{{order.name}}</div>  
          </div>          <div class='flex flex-row items-center'>  
            <div class='flex items-center text-md text-gray-500 font-normal mr-1'>Comments:</div>  
            <div class='text-md font-medium '>{{order.comment}}</div>  
          </div>  
          <div>            <div class='flex items-center text-md font-medium mt-2'>Orders:</div>  
            <div class='flex flex-row  mb-1 gap-2 overflow-y-scroll'>  
              <div *ngFor='let prod of order.orderedProducts' class='shrink-0'>  
                <img [src]='prod.product.img'  
                     class=' h-16 w-[100px] object-center object-cover cursor-pointer rounded-md ' />  
                <div class='text-xs mt-1 font-medium tracking-tight'>{{prod.product.name}}<span  
                  class='font-light'>(x{{prod.quantity}})</span></div>  
              </div>            </div>          </div>  
  
        </div>      </div>      <ng-container>  
        <div class='absolute top-[15px] right-[15px]'>  
          <div            [ngClass]="{  
            'bg-red-100 text-red-700':order.orderStatus === ORDER_STATUS.ORDER_CANCELED,  
            'bg-gray-100 text-gray-700':order.orderStatus === ORDER_STATUS.ORDER_NEW,  
            'bg-yellow-100 text-yellow-700':order.orderStatus === ORDER_STATUS.ORDER_ACCEPTED,  
            'bg-orange-100 text-orange-700':order.orderStatus === ORDER_STATUS.ORDER_PROCESSING,  
            'bg-green-100 text-green-700':order.orderStatus === ORDER_STATUS.ORDER_DELIVERED  
            }"  
            class='  py-1.5 px-2 text-xs font-semibold tracking-wide rounded-md'>  
            {{order.orderStatus}}  
          </div>  
        </div>        <div class='absolute right-[15px] bottom-[15px]'>  
          <div class='bg-gray-800 py-1 px-2 rounded text-white text-lg font-semibold'>  
            ${{order.orderPaymentSummaryExtraFee.total}}</div>  
        </div>  
  
      </ng-container>      <div class='absolute -inset-px rounded-lg border-[3px] pointer-events-none' aria-hidden='true'></div>  
    </div>  </ng-container></div>
```

food-shop-orders-order-card-list.module.ts
```ts
import { NgModule } from '@angular/core';  
import { CommonModule } from '@angular/common';  
import { OrderCardListComponent } from './components/order-card-list.component';  
  
@NgModule({  
  declarations: [OrderCardListComponent],  
  imports: [CommonModule],  
  exports: [OrderCardListComponent],  
})  
export class FoodShopOrdersOrderCardListModule {}
```

index.ts
```ts
export * from './lib/food-shop-orders-order-card-list.module';  
export * from './lib/components/order-card-list.component';
```

### Generate Order Details Library 
In `src/lib/components` create `order-status-bar` and `order-details` component.

order-status-bar.component.ts
```ts
import { Component, Input, OnChanges, SimpleChanges } from '@angular/core';  
import {  
  Order,  
  OrderStatus,  
} from '@food-shop-architecture-workshop/core/model';  
  
@Component({  
  selector: 'app-order-status-bar',  
  templateUrl: 'order-status-bar.component.html',  
})  
export class OrderStatusBarComponent implements OnChanges {  
  ORDER_STATUS = OrderStatus;  
  
  barNumberWidth = 0;  
  
  @Input()  
  order!: Order;  
  
  ngOnChanges(changes: SimpleChanges): void {  
    if (changes && changes['order']?.currentValue) {  
      this.barNumberWidth = this.calculateWidth(  
        changes['order']?.currentValue?.orderStatus  
      );  
    }  
  }  
  
  private calculateWidth(orderStatus: OrderStatus) {  
    const x =  
      orderStatus === OrderStatus.ORDER_NEW  
        ? 0  
        : orderStatus === OrderStatus.ORDER_ACCEPTED  
        ? 1  
        : orderStatus === OrderStatus.ORDER_PROCESSING  
        ? 2  
        : 4;  
    return (x * 2 + 1) / 8;  
  }  
}
```

Create Order Status Bar Component
order-status-bar.component.html
```html
<div class='border-t border-gray-200 py-4 '>  
  
  <p class='text-sm font-semibold  text-gray-900'>  
    <ng-container [ngSwitch]='order.orderStatus'>  
      <ng-container *ngSwitchCase='ORDER_STATUS.ORDER_NEW'>  
        Submitted on {{order.orderDate | date : 'dd MMM YYYY hh:mm'}}  
      </ng-container>  
      <ng-container *ngSwitchCase='ORDER_STATUS.ORDER_ACCEPTED'>  
        Accepted on {{order.orderDate | date : 'dd MMM YYYY hh:mm'}}  
      </ng-container>  
      <ng-container *ngSwitchCase='ORDER_STATUS.ORDER_DELIVERED'>  
        Delivered on {{order.orderDate | date : 'dd MMM YYYY hh:mm'}}  
      </ng-container>  
      <ng-container *ngSwitchCase='ORDER_STATUS.ORDER_PROCESSING'>  
        Processed on {{order.orderDate | date : 'dd MMM YYYY hh:mm'}}  
      </ng-container>  
      <ng-container *ngSwitchCase='ORDER_STATUS.ORDER_CANCELED'>  
        Canceled on {{order.orderDate | date : 'dd MMM YYYY hh:mm'}}  
      </ng-container>  
      <ng-container *ngSwitchDefault>Missing status</ng-container>  
    </ng-container>  </p>  <div class='mt-4' aria-hidden='true'>  
    <div class='bg-gray-200 rounded-full overflow-hidden'>  
      <div class='h-2 rounded-full'  
           [ngStyle]="{'width': 'calc('+barNumberWidth+' * 100%)'}"  
           [ngClass]="{  
           'bg-orange-600': order.orderStatus !== ORDER_STATUS.ORDER_CANCELED && order.orderStatus !== ORDER_STATUS.ORDER_DELIVERED,  
           'bg-red-500': order.orderStatus === ORDER_STATUS.ORDER_CANCELED,  
           'bg-green-500': order.orderStatus === ORDER_STATUS.ORDER_DELIVERED  
           }"  
      ></div>  
    </div>    <div class='hidden sm:grid grid-cols-4 text-sm font-medium text-gray-600 mt-4'>  
      <div [ngClass]="{'text-orange-500': order.orderStatus === ORDER_STATUS.ORDER_NEW}">Order placed</div>  
      <div [ngClass]="{'text-orange-500': order.orderStatus === ORDER_STATUS.ORDER_ACCEPTED}" class='text-center'>Order  
        accepted  
      </div>  
      <div [ngClass]="{'text-orange-500': order.orderStatus === ORDER_STATUS.ORDER_PROCESSING}" class='text-center'>  
        Order Processing  
      </div>  
      <div        [ngClass]="{'text-green-600': order.orderStatus === ORDER_STATUS.ORDER_DELIVERED, 'text-red-500': order.orderStatus === ORDER_STATUS.ORDER_CANCELED}"  
        class='text-right'>  
        <ng-container *ngIf='order.orderStatus === ORDER_STATUS.ORDER_CANCELED else delivered'>  
          Order Canceled  
        </ng-container>  
        <ng-template #delivered>  
          Order Delivered  
        </ng-template>  
      </div>    </div>  </div></div>
```

Create Order Details Component
order-details.component.ts
```ts
import { Component, Input } from '@angular/core';  
import { Order } from '@food-shop-architecture-workshop/core/model';  
  
@Component({  
  selector: 'app-order-details',  
  templateUrl: 'order-details.component.html',  
})  
export class OrderDetailsComponent {  
  @Input()  
  order!: Order;  
}
```

order-details.component.html
```html
<div class='  
  lg:grid lg:grid-rows-[minmax(0,_max-content)_minmax(330px,_330px)]   mx-auto lg:max-w-7xl h-full px-4 overflow-y-scroll'>  
  
  <div class='overflow-y-scroll'>  
    <ng-container *ngFor='let productCart of order.orderedProducts; let first=first'>  
      <li class='flex items-start pb-4 space-x-4 mx-2' [ngClass]="{'mt-4':first}">  
        <img [src]='productCart.product.img' class='flex-none w-[120px] h-[120px] rounded-md object-center object-cover'  
             alt='Product image' />  
        <div class='flex-auto space-y-1 h-full mt-auto mb-auto'>  
          <h3 class='text-lg'>{{productCart.product.name}}</h3>  
          <div class='flex flex-row gap-2 text-gray-500 text-sm font-normal'>  
            <ng-container *ngIf='productCart.product.ingredients'>  
              {{productCart.product.ingredients.join(', ')}}  
            </ng-container>  
          </div>        </div>        <div class='mt-auto mb-auto'>  
          <p class='text-end flex-none text-base text-gray-800 text-sm text-gray-500 font-normal'>  
            ${{productCart.product.price}}</p>  
          <p class='text-end flex-none text-base text-gray-800 text-sm text-gray-500 font-normal'>  
            x {{productCart.quantity}}</p>  
          <p class='text-end flex-none text-base text-gray-800 whitespace-nowrap font-semibold mt-2'>  
            ${{productCart.quantity * productCart.product.price | number : '1.2-2'}}</p>  
        </div>      </li>    </ng-container>  </div>  
  <div>    <app-order-status-bar [order]='order'></app-order-status-bar>  
    <div class='mt-4 mb-4'>  
      <div class='bg-gray-100 py-4 px-4 sm:px-6 sm:rounded-lg lg:px-4 lg:py-4 lg:grid lg:grid-cols-12 lg:gap-x-8'>  
        <dl class='grid grid-cols-2 gap-6 text-sm sm:grid-cols-2 md:gap-x-8 lg:col-span-7'>  
          <div>            <dt class='font-medium text-gray-900'>Billing details</dt>  
            <dd class='mt-3 text-gray-500'>  
              <span class='block'>{{order.name}}</span>  
              <span class='block'>Table : {{order.table}}</span>  
              <span class='block'>{{order.comment}}</span>  
            </dd>          </div>          <div>            <dt class='font-medium text-gray-900'>Payment information</dt>  
            <div class='mt-3'>  
              <dd class='-ml-4 -mt-4 flex flex-wrap'>  
                <div class='ml-4 mt-4 flex-shrink-0'>  
  
                  <svg aria-hidden='true' width='36' height='24' viewBox='0 0 36 24' xmlns='http://www.w3.org/2000/svg'  
                       class='h-6 w-auto'>  
                    <rect width='36' height='24' rx='4' fill='#224DBA' />  
                    <path                      d='M10.925 15.673H8.874l-1.538-6c-.073-.276-.228-.52-.456-.635A6.575 6.575 0 005 8.403v-.231h3.304c.456 0 .798.347.855.75l.798 4.328 2.05-5.078h1.994l-3.076 7.5zm4.216 0h-1.937L14.8 8.172h1.937l-1.595 7.5zm4.101-5.422c.057-.404.399-.635.798-.635a3.54 3.54 0 011.88.346l.342-1.615A4.808 4.808 0 0020.496 8c-1.88 0-3.248 1.039-3.248 2.481 0 1.097.969 1.673 1.653 2.02.74.346 1.025.577.968.923 0 .519-.57.75-1.139.75a4.795 4.795 0 01-1.994-.462l-.342 1.616a5.48 5.48 0 002.108.404c2.108.057 3.418-.981 3.418-2.539 0-1.962-2.678-2.077-2.678-2.942zm9.457 5.422L27.16 8.172h-1.652a.858.858 0 00-.798.577l-2.848 6.924h1.994l.398-1.096h2.45l.228 1.096h1.766zm-2.905-5.482l.57 2.827h-1.596l1.026-2.827z'  
                      fill='#fff' />  
                  </svg>                </div>                <div class='ml-4 mt-4'>  
                  <p class='text-gray-900'>Ending with 1214</p>  
                  <p class='text-gray-600'>Expires 07 / 25</p>  
                </div>              </dd>            </div>          </div>        </dl>  
        <dl class='mt-4 divide-y divide-gray-200 lg:mt-0 lg:col-span-5'>  
          <div class='pb-2 flex items-center justify-between text-xs'>  
            <dt class=' text-gray-600'>Subtotal</dt>  
            <dd class=' font-medium text-gray-600'>  
              ${{order.orderPaymentSummaryExtraFee.subtotal  | number : '1.2-2'}}</dd>  
          </div>          <div class='py-2 flex items-center justify-between text-xs'>  
            <dt class='text-gray-600'>Service Charge ({{order.orderPaymentSummaryExtraFee.serviceChargePercentage}}%)  
            </dt>  
            <dd class='font-medium text-gray-600'>  
              ${{order.orderPaymentSummaryExtraFee.serviceCharge  | number : '1.2-2'}}</dd>  
          </div>          <div class='py-2 flex items-center justify-between text-xs'>  
            <dt class='text-gray-600'>Payment fee</dt>  
            <dd class='font-medium text-gray-600'>  
              ${{order.orderPaymentSummaryExtraFee.paymentFee  | number : '1.2-2'}}</dd>  
          </div>          <div class='py-2 flex items-center justify-between text-xs'>  
            <dt class='text-gray-600'>Vat Rate ({{order.orderPaymentSummaryExtraFee.vatRatePercentage}}%)</dt>  
            <dd class='font-medium text-gray-600'>  
              ${{order.orderPaymentSummaryExtraFee.vatRate  | number : '1.2-2'}}</dd>  
          </div>          <div class='pt-2 flex items-center justify-between text-sm'>  
            <dt class='font-medium text-gray-800'>Total</dt>  
            <dd class='font-medium text-gray-800'>${{order.orderPaymentSummaryExtraFee.total}}</dd>  
          </div>        </dl>      </div>    </div>  </div>  
  
</div>
```